# Риск ДТП

## Обзор проекта

Этот проект направлен на разработку системы, способной оценивать риск дорожно-транспортных происшествий вдоль выбранного маршрута движения. Система предназначена для предупреждения водителей и предоставления рекомендаций по маршруту при обнаружении высокого уровня риска. Решение находится на стадии предварительного обсуждения и разработки, при этом четких существующих алгоритмов или аналогичных рыночных решений пока нет.

## Бизнес-задача

Текущая цель - определить, возможно ли прогнозировать дорожно-транспортные происшествия на основе исторических данных одного региона. Предложенный заказчиком подход включает:

1. Создание модели прогнозирования аварий (целевое значение - `at_fault` в таблице `parties`)
2. Исследование основных факторов аварийности на основе модели
3. Понимание, могут ли результаты моделирования и анализ важности факторов ответить на вопросы:
   - Возможно ли создать адекватную систему оценки водительского риска при выдаче автомобиля?
   - Какие еще факторы необходимо учитывать?
   - Нужно ли оборудовать автомобили какими-либо датчиками или камерами?

## Описание данных

Проект использует четыре основные таблицы из базы данных PostgreSQL:

- `collisions` - Общая информация о ДТП с уникальным `case_id`
- `parties` - Информация об участниках ДТП с неуникальным `case_id`
- `vehicles` - Информация о пострадавших транспортных средствах
- `case_ids` - Таблица, содержащая уникальные идентификаторы случаев

## Структура проекта

### 1. Подключение к базе данных и загрузка таблиц
- Установлено соединение с базой данных PostgreSQL
- Исследована структура таблиц и связи между ними
- Определены первичные и внешние ключи

### 2. Первичное исследование таблиц
- Проанализирована полнота и качество данных
- Выявлены пропущенные значения и аномалии данных
- Исследованы распределения данных и закономерности

### 3. Статистический анализ факторов ДТП
- Проанализированы аварии по месяцам (данные за 2012 год неполные)
- Созданы аналитические задачи для коллег, включая:
  - Влияние состояния дорожного покрытия на тяжесть аварий
  - Анализ возраста транспортных средств в авариях
  - Связь между типом коробки передач и временем суток
- Реализованы решения для трех аналитических задач

### 4. Модель оценки водительского риска
- Отобраны релевантные признаки для моделирования
- Подготовлен набор данных с критериями фильтрации:
  - Только участники типа "автомобиль"
  - Аварии со значительными повреждениями (исключая царапины)
  - Только данные за 2012 год
- Проведен статистический анализ отобранных факторов
- Построены и сравнены три модели классификации:
  - Логистическая регрессия
  - Случайный лес
  - CatBoost

### 5. Выбор модели и оценка
- Выбрана F1-мера в качестве основной метрики
- Случайный лес показал наилучший результат с F1-score 0.606
- Оптимизирован порог классификации до 0.363
- Достигнута высокая полнота (89.4%) при более низкой точности (54.5%)

### 6. Анализ важности факторов
- Наиболее важные признаки:
  - Тип транспортного средства
  - Возраст транспортного средства
  - Наличие устройств контроля
  - Направление движения
  - Тип коробки передач
- Дополнительный анализ типа коробки передач показал, что автомобили с механической КПП чаще являются виновниками

## Ключевые выводы

### Закономерности аварий
- Наибольшее количество аварий происходит в октябре, декабре и марте
- Автомобили с механической коробкой передач чаще становятся виновниками, особенно ночью
- Автомобили возрастом 2-4 года чаще всего попадают в аварии
- Купе чаще являются виновниками ДТП

### Производительность модели
- Лучшая модель: Случайный лес с F1-score 0.606
- С оптимизированным порогом: Полнота 89.4%, Точность 54.5%
- Модель эффективно идентифицирует большинство случаев виновности, но с большим количеством ложных срабатываний

### Технические рекомендации
Для автомобилей с механической КПП (более высокий профиль риска):
- Автоматическое включение фар
- Системы мониторинга слепых зон
- Системы курсовой устойчивости
- Парктроники и камеры
- Мониторинг усталости водителя

## Ограничения и дальнейшая работа

Текущие данные имеют значительные ограничения для построения практической системы оценки рисков:

1. **Дисбаланс данных**: Содержит только данные об авариях, отсутствует информация о безопасных поездках
2. **Временное покрытие**: Данные за 2012 год неполные
3. **Доступность признаков**: Отсутствуют многие важные факторы в реальном времени

Для построения эффективной системы необходимы дополнительные данные:
- Данные о поездках без аварий
- Метрики поведения вождения в реальном времени
- Данные о состоянии дорог
- Погодные условия
- Информация о плотности traffic

## Заключение

Хотя проект успешно выявил ключевые факторы, влияющие на виновность в авариях, текущие ограничения данных не позволяют построить полностью функциональную систему оценки рисков. Наиболее перспективным направлением для дальнейшей разработки является сбор комплексных данных о поездках (как с авариями, так и без них) и включение метрик поведения вождения в реальном времени.
